{% extends 'baseBack.html.twig' %}

{% block title %}Commentaire Index{% endblock %}

{% block body %}
<div class="container py-4">
    <h1 class="display-4 mb-4">Commentaire Index</h1>

    <div class="d-flex justify-content-between mb-4">
        <a href="{{ path('app_commentaire_back_new') }}" class="btn btn-success">Create New</a>
    </div>
    <div class="card border-0 shadow">
        <div class="card-body">
            <!-- Search field for filtering the table -->
            <div class="mb-4 d-flex">
                <input type="text" id="searchInput" class="form-control me-2" placeholder="Search comments...">
                <select id="sortSelect" class="form-control">
                    <option value="id">ID</option>
                    <option value="contenu">Contenu</option>
                    <option value="dateCommentaire">Date de Commentaire</option>
                </select>
            </div>

            <!-- Table for displaying comments -->
            <table class="table table-striped table-hover" id="commentaireTable">
                <thead>
                    <tr>
                       
                        <th>Contenu</th>
                        <th>Date de Commentaire</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for commentaire in commentaires %}
                    <tr>
                       
                        <td>{{ commentaire.contenu }}</td>
                        <td>{{ commentaire.dateCommentaire ? commentaire.dateCommentaire|date('Y-m-d H:i:s') : 'N/A' }}</td>
                        <td>
                            <a href="{{ path('app_commentaire_back_show', {'id': commentaire.id}) }}" class="btn btn-sm btn-info">Show</a>
                            <a href="{{ path('app_commentaire_back_edit', {'id': commentaire.id}) }}" class="btn btn-sm btn-primary">Edit</a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">No records found</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
   const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const table = document.getElementById('commentaireTable');

    // Dynamic search to filter table rows
    searchInput.addEventListener('input', function() {
        const searchValue = this.value.toLowerCase();
        const rows = table.getElementsByTagName('tr');

        for (let i = 1; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            let rowContainsValue = false;

            for (const cell of cells) {
                if (cell.innerText.toLowerCase().includes(searchValue)) {
                    rowContainsValue = true;
                    break;
                }
            }

            // Toggle the display of rows based on whether they contain the search value
            rows[i].style.display = rowContainsValue ? '' : 'none';
        }
    });

    // Sorting functionality based on the selected field
    sortSelect.addEventListener('change', function() {
        const sortField = this.value;
        const rows = Array.from(table.getElementsByTagName('tr')).slice(1);
        let index = 0;

        // Determine the index to sort by based on the selected field
        if (sortField === 'contenu') {
            index = 1; // The 'Contenu' column
        } else if (sortField === 'dateCommentaire') {
            index = 2; // The 'Date de Commentaire' column
        } else {
            index = 0; // Default to 'ID'
        }

        // Sort rows based on the selected field
        rows.sort((a, b) => {
            const aValue = a.getElementsByTagName('td')[index].innerText;
            const bValue = b.getElementsByTagName('td')[index].innerText;

            // If sorting by date, convert to Date object for comparison
            if (sortField === 'dateCommentaire') {
                return new Date(aValue) - new Date(bValue);
            } else {
                return aValue.localeCompare(bValue);
            }
        });

        // Re-render the table with the sorted rows
        const tbody = table.getElementsByTagName('tbody')[0];
        tbody.innerHTML = '';
        rows.forEach(row => tbody.appendChild(row));
    });
</script>
{% endblock %}
