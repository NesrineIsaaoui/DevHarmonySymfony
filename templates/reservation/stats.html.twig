{% extends 'baseBack.html.twig' %}

{% block title %}Reservation {% endblock %}

{% block body %}

{% block content %}
    <div class="container-fluid page-body-wrapper">
        <!-- partial:../../partials/_sidebar.html -->
       
        <!-- partial -->
        <div class="main-panel">
            <div class="content-wrapper">
                <div class="page-header">
                    <h3 class="page-title"> Admin Statistics </h3>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#">Charts</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Chart-js</li>
                        </ol>
                    </nav>
                </div>
                <div class="row">
                    <div class="col-lg-6 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Total Profit: ${{ totalProfit }}</h4>
                                <div class="chart-container" style="position: relative; height:350px; width:100%;">
                                    <canvas id="coursePurchasesChart"></canvas>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-primary" id="exportExcel">Export to Excel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Add other charts here if needed -->
                </div>
            </div>
            <!-- content-wrapper ends -->
            <!-- partial:../../partials/_footer.html -->
            <footer class="footer">
                <div class="container-fluid d-flex justify-content-between">
                    <span class="text-muted d-block text-center text-sm-start d-sm-inline-block">Copyright Â© bootstrapdash.com 2021</span>
                    <span class="float-none float-sm-end mt-1 mt-sm-0 text-end"> Free <a href="https://www.bootstrapdash.com/bootstrap-admin-template/" target="_blank">Bootstrap admin template</a> from Bootstrapdash.com</span>
                </div>
            </footer>
            <!-- partial -->
        </div>
        <!-- main-panel ends -->
    </div>
    <!-- container-scroller -->
{% endblock %}

{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script>
        var ctx = document.getElementById('coursePurchasesChart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: [{% for courseName, _ in coursePurchases %}"{{ courseName }}", {% endfor %}],
                datasets: [{
                    label: 'Course Purchases',
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 206, 86, 0.5)',
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(153, 102, 255, 0.5)',
                        'rgba(255, 159, 64, 0.5)'
                    ],
                    data: [{% for _, purchaseCount in coursePurchases %}{{ purchaseCount }}, {% endfor %}]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
            }
        });

        document.getElementById('exportExcel').addEventListener('click', function() {
            var labels = [{% for courseName, _ in coursePurchases %}"{{ courseName }}", {% endfor %}];
            var data = [{% for _, purchaseCount in coursePurchases %}{{ purchaseCount }}, {% endfor %}];

            var wsData = [['Course Name', 'Purchase Count']];
            for (var i = 0; i < labels.length; i++) {
                wsData.push([labels[i], data[i]]);
            }

            var ws = XLSX.utils.aoa_to_sheet(wsData);
            var wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Course Purchases");
            XLSX.writeFile(wb, 'course_purchases.xlsx');
        });

       
    </script>
{% endblock %}

{% endblock %}
